/*
---------------------------------------------------------------
File name:          template_scaffold.dart
Author:             lgnorant-lu
Date created:       2025/07/10
Last modified:      2025/07/12
Dart Version:       3.2+
Description:        ä¼ä¸šçº§æ¨¡æ¿è„šæ‰‹æ¶ç”Ÿæˆå™¨ (Enterprise Template Scaffold Generator)
---------------------------------------------------------------
Change History:
    2025/07/10: Initial creation - Phase 2.1 è‡ªå®šä¹‰æ¨¡æ¿åˆ›å»ºå·¥å…·;
    2025/07/12: Add dependencies and devDependencies - è‡ªå®šä¹‰æ¨¡æ¿åˆ›å»ºå·¥å…·;
---------------------------------------------------------------
*/

import 'dart:io';

import 'package:ming_status_cli/src/core/template_system/template_metadata.dart';
import 'package:ming_status_cli/src/core/template_system/template_types.dart';
import 'package:ming_status_cli/src/utils/logger.dart' as cli_logger;
import 'package:path/path.dart' as path;

/// è„šæ‰‹æ¶é…ç½®
///
/// å®šä¹‰æ¨¡æ¿è„šæ‰‹æ¶çš„é…ç½®å‚æ•°
class ScaffoldConfig {
  /// åˆ›å»ºè„šæ‰‹æ¶é…ç½®å®ä¾‹
  const ScaffoldConfig({
    required this.templateName,
    required this.templateType,
    required this.author,
    required this.description,
    this.subType,
    this.version = '1.0.0',
    this.outputPath = '.',
    this.platform = TemplatePlatform.crossPlatform,
    this.framework = TemplateFramework.agnostic,
    this.complexity = TemplateComplexity.simple,
    this.maturity = TemplateMaturity.development,
    this.tags = const [],
    this.dependencies = const [],
    this.includeTests = true,
    this.includeDocumentation = true,
    this.includeExamples = true,
    this.enableGitInit = true,
  });

  /// æ¨¡æ¿åç§°
  final String templateName;

  /// æ¨¡æ¿ç±»å‹
  final TemplateType templateType;

  /// æ¨¡æ¿å­ç±»å‹
  final TemplateSubType? subType;

  /// ä½œè€…ä¿¡æ¯
  final String author;

  /// æ¨¡æ¿æè¿°
  final String description;

  /// æ¨¡æ¿ç‰ˆæœ¬
  final String version;

  /// è¾“å‡ºè·¯å¾„
  final String outputPath;

  /// ç›®æ ‡å¹³å°
  final TemplatePlatform platform;

  /// æŠ€æœ¯æ¡†æ¶
  final TemplateFramework framework;

  /// å¤æ‚åº¦ç­‰çº§
  final TemplateComplexity complexity;

  /// æˆç†Ÿåº¦ç­‰çº§
  final TemplateMaturity maturity;

  /// æ ‡ç­¾åˆ—è¡¨
  final List<String> tags;

  /// ä¾èµ–åˆ—è¡¨
  final List<String> dependencies;

  /// æ˜¯å¦åŒ…å«æµ‹è¯•
  final bool includeTests;

  /// æ˜¯å¦åŒ…å«æ–‡æ¡£
  final bool includeDocumentation;

  /// æ˜¯å¦åŒ…å«ç¤ºä¾‹
  final bool includeExamples;

  /// æ˜¯å¦å¯ç”¨Gitåˆå§‹åŒ–
  final bool enableGitInit;
}

/// è„šæ‰‹æ¶ç”Ÿæˆç»“æœ
///
/// åŒ…å«è„šæ‰‹æ¶ç”Ÿæˆçš„ç»“æœä¿¡æ¯
class ScaffoldResult {
  /// åˆ›å»ºè„šæ‰‹æ¶ç”Ÿæˆç»“æœå®ä¾‹
  const ScaffoldResult({
    required this.success,
    required this.templatePath,
    this.generatedFiles = const [],
    this.errors = const [],
    this.warnings = const [],
  });

  /// åˆ›å»ºæˆåŠŸç»“æœ
  factory ScaffoldResult.success({
    required String templatePath,
    required List<String> generatedFiles,
    List<String> warnings = const [],
  }) {
    return ScaffoldResult(
      success: true,
      templatePath: templatePath,
      generatedFiles: generatedFiles,
      warnings: warnings,
    );
  }

  /// åˆ›å»ºå¤±è´¥ç»“æœ
  factory ScaffoldResult.failure({
    required List<String> errors,
    String templatePath = '',
    List<String> warnings = const [],
  }) {
    return ScaffoldResult(
      success: false,
      templatePath: templatePath,
      errors: errors,
      warnings: warnings,
    );
  }

  /// æ˜¯å¦æˆåŠŸ
  final bool success;

  /// æ¨¡æ¿è·¯å¾„
  final String templatePath;

  /// ç”Ÿæˆçš„æ–‡ä»¶åˆ—è¡¨
  final List<String> generatedFiles;

  /// é”™è¯¯åˆ—è¡¨
  final List<String> errors;

  /// è­¦å‘Šåˆ—è¡¨
  final List<String> warnings;
}

/// ä¼ä¸šçº§æ¨¡æ¿è„šæ‰‹æ¶ç”Ÿæˆå™¨
///
/// è‡ªåŠ¨ç”Ÿæˆæ¨¡æ¿ç›®å½•ç»“æ„ã€é…ç½®æ–‡ä»¶ã€ç¤ºä¾‹ä»£ç 
class TemplateScaffold {
  /// åˆ›å»ºæ¨¡æ¿è„šæ‰‹æ¶ç”Ÿæˆå™¨å®ä¾‹
  TemplateScaffold();

  /// ç”Ÿæˆæ¨¡æ¿è„šæ‰‹æ¶
  ///
  /// æ ¹æ®é…ç½®ç”Ÿæˆå®Œæ•´çš„æ¨¡æ¿é¡¹ç›®ç»“æ„
  Future<ScaffoldResult> generateScaffold(ScaffoldConfig config) async {
    try {
      cli_logger.Logger.info('å¼€å§‹ç”Ÿæˆæ¨¡æ¿è„šæ‰‹æ¶: ${config.templateName}');

      // 1. åˆ›å»ºæ¨¡æ¿ç›®å½•
      final templatePath = await _createTemplateDirectory(config);

      // 2. ç”ŸæˆåŸºç¡€æ–‡ä»¶ç»“æ„
      final generatedFiles = <String>[];

      // ç”Ÿæˆå…ƒæ•°æ®æ–‡ä»¶
      await _generateMetadataFile(templatePath, config);
      generatedFiles.add('template.yaml');

      // ç”Ÿæˆæ¨¡æ¿æ–‡ä»¶
      await _generateTemplateFiles(templatePath, config);
      generatedFiles.addAll(await _getTemplateFiles(templatePath, config));

      // ç”Ÿæˆé…ç½®æ–‡ä»¶
      await _generateConfigFiles(templatePath, config);
      generatedFiles.addAll(['pubspec.yaml', '.gitignore']);

      // æ·»åŠ Flutterç‰¹å®šé…ç½®æ–‡ä»¶
      if (config.framework == TemplateFramework.flutter) {
        generatedFiles.addAll([
          'analysis_options.yaml',
          'l10n.yaml',
          'build.yaml',
          'flutter_gen.yaml',
        ]);

        // æ·»åŠ æ¡ä»¶é…ç½®æ–‡ä»¶
        if (config.templateType == TemplateType.full ||
            config.templateType == TemplateType.micro) {
          generatedFiles.add('melos.yaml');
        }

        if (config.templateType == TemplateType.full) {
          generatedFiles.add('shorebird.yaml');
        }
      }

      // ç”Ÿæˆæ–‡æ¡£
      if (config.includeDocumentation) {
        await _generateDocumentation(templatePath, config);
        generatedFiles.addAll(['README.md', 'CHANGELOG.md']);
      }

      // ç”Ÿæˆæµ‹è¯•
      if (config.includeTests) {
        await _generateTests(templatePath, config);
        generatedFiles.add('test/template_test.dart');
      }

      // ç”Ÿæˆç¤ºä¾‹
      if (config.includeExamples) {
        await _generateExamples(templatePath, config);
        generatedFiles.add('example/example.dart');
      }

      // Gitåˆå§‹åŒ–
      if (config.enableGitInit) {
        await _initializeGit(templatePath);
      }

      cli_logger.Logger.success(
        'æ¨¡æ¿è„šæ‰‹æ¶ç”Ÿæˆå®Œæˆ: ${config.templateName} '
        '(${generatedFiles.length}ä¸ªæ–‡ä»¶)',
      );

      return ScaffoldResult.success(
        templatePath: templatePath,
        generatedFiles: generatedFiles,
      );
    } catch (e) {
      cli_logger.Logger.error('æ¨¡æ¿è„šæ‰‹æ¶ç”Ÿæˆå¤±è´¥', error: e);
      return ScaffoldResult.failure(
        errors: ['è„šæ‰‹æ¶ç”Ÿæˆå¼‚å¸¸: $e'],
      );
    }
  }

  /// åˆ›å»ºæ¨¡æ¿ç›®å½•
  Future<String> _createTemplateDirectory(ScaffoldConfig config) async {
    final templatePath = path.join(config.outputPath, config.templateName);
    final templateDir = Directory(templatePath);

    if (await templateDir.exists()) {
      throw Exception('æ¨¡æ¿ç›®å½•å·²å­˜åœ¨: $templatePath');
    }

    await templateDir.create(recursive: true);

    // æ ¹æ®æ¡†æ¶ç±»å‹åˆ›å»ºä¸åŒçš„ç›®å½•ç»“æ„
    if (config.framework == TemplateFramework.flutter) {
      await _createFlutterDirectoryStructure(templatePath, config);
    } else {
      await _createDartDirectoryStructure(templatePath, config);
    }

    return templatePath;
  }

  /// åˆ›å»ºFlutteré¡¹ç›®ç›®å½•ç»“æ„
  Future<void> _createFlutterDirectoryStructure(
    String templatePath,
    ScaffoldConfig config,
  ) async {
    // Flutteré¡¹ç›®çš„å®Œæ•´ç›®å½•ç»“æ„
    final flutterDirs = [
      // æ ¸å¿ƒæºç ç›®å½•
      'lib',
      'lib/src',
      'lib/src/models',
      'lib/src/services',
      'lib/src/widgets',
      'lib/src/screens',
      'lib/src/utils',
      'lib/src/constants',
      'lib/src/providers',
      'lib/src/repositories',
      'lib/generated', // flutter_genç”Ÿæˆçš„æ–‡ä»¶

      // æµ‹è¯•ç›®å½•
      if (config.includeTests) 'test',
      if (config.includeTests) 'test/unit',
      if (config.includeTests) 'test/widget',
      if (config.includeTests) 'integration_test',

      // èµ„æºç›®å½•
      'assets',
      'assets/images',
      'assets/icons',
      'assets/fonts',

      // å›½é™…åŒ–ç›®å½•
      'l10n',

      // å¹³å°ç‰¹å®šç›®å½•
      if (config.platform == TemplatePlatform.mobile ||
          config.platform == TemplatePlatform.crossPlatform) ...[
        'android',
        'android/app',
        'android/app/src',
        'android/app/src/main',
        'android/app/src/main/kotlin',
        'ios',
        'ios/Runner',
      ],
      if (config.platform == TemplatePlatform.web ||
          config.platform == TemplatePlatform.crossPlatform) ...[
        'web',
      ],
      if (config.platform == TemplatePlatform.desktop ||
          config.platform == TemplatePlatform.crossPlatform) ...[
        'windows',
        'macos',
        'linux',
      ],

      // æ–‡æ¡£å’Œç¤ºä¾‹
      if (config.includeDocumentation) 'docs',
      if (config.includeExamples) 'example',

      // æ¨¡æ¿ç‰¹å®šç›®å½•
      'templates',
      'config',
    ];

    for (final dir in flutterDirs) {
      await Directory(path.join(templatePath, dir)).create(recursive: true);
    }
  }

  /// åˆ›å»ºDarté¡¹ç›®ç›®å½•ç»“æ„
  Future<void> _createDartDirectoryStructure(
    String templatePath,
    ScaffoldConfig config,
  ) async {
    // Darté¡¹ç›®çš„åŸºç¡€ç›®å½•ç»“æ„
    final dartDirs = [
      // æ ¸å¿ƒæºç ç›®å½•
      'lib',
      'lib/src',

      // æµ‹è¯•ç›®å½•
      if (config.includeTests) 'test',

      // æ–‡æ¡£å’Œç¤ºä¾‹
      if (config.includeDocumentation) 'docs',
      if (config.includeExamples) 'example',

      // æ¨¡æ¿ç‰¹å®šç›®å½•
      'templates',
      'config',
    ];

    for (final dir in dartDirs) {
      await Directory(path.join(templatePath, dir)).create(recursive: true);
    }
  }

  /// ç”Ÿæˆå…ƒæ•°æ®æ–‡ä»¶
  Future<void> _generateMetadataFile(
    String templatePath,
    ScaffoldConfig config,
  ) async {
    final metadata = TemplateMetadata(
      id: _generateTemplateId(config.templateName),
      name: config.templateName,
      version: config.version,
      author: config.author,
      description: config.description,
      type: config.templateType,
      subType: config.subType,
      tags: config.tags,
      complexity: config.complexity,
      maturity: config.maturity,
      platform: config.platform,
      framework: config.framework,
      dependencies: config.dependencies
          .map((dep) => TemplateDependency(name: dep, version: '^1.0.0'))
          .toList(),
      createdAt: DateTime.now(),
      updatedAt: DateTime.now(),
    );

    final metadataFile = File(path.join(templatePath, 'template.yaml'));
    await metadataFile.writeAsString(_generateMetadataYaml(metadata));
  }

  /// ç”Ÿæˆæ¨¡æ¿æ–‡ä»¶
  Future<void> _generateTemplateFiles(
    String templatePath,
    ScaffoldConfig config,
  ) async {
    final templatesDir = path.join(templatePath, 'templates');

    // æ ¹æ®æ¨¡æ¿ç±»å‹ç”Ÿæˆä¸åŒçš„æ¨¡æ¿æ–‡ä»¶
    switch (config.templateType) {
      case TemplateType.ui:
        await _generateUITemplates(templatesDir, config);
      case TemplateType.service:
        await _generateServiceTemplates(templatesDir, config);
      case TemplateType.data:
        await _generateDataTemplates(templatesDir, config);
      case TemplateType.full:
        await _generateFullTemplates(templatesDir, config);
      case TemplateType.system:
        await _generateSystemTemplates(templatesDir, config);
      case TemplateType.basic:
        await _generateBasicTemplates(templatesDir, config);
      case TemplateType.micro:
        await _generateMicroTemplates(templatesDir, config);
      case TemplateType.plugin:
        await _generatePluginTemplates(templatesDir, config);
      case TemplateType.infrastructure:
        await _generateInfrastructureTemplates(templatesDir, config);
    }
  }

  /// ç”ŸæˆUIæ¨¡æ¿
  Future<void> _generateUITemplates(
    String templatesDir,
    ScaffoldConfig config,
  ) async {
    final mainFile = File(path.join(templatesDir, 'main.dart.template'));
    await mainFile.writeAsString('''
{{#if platform.flutter}}
import 'package:flutter/material.dart';

class {{componentName}} extends StatelessWidget {
  const {{componentName}}({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return {{#if subType.page}}Scaffold(
      appBar: AppBar(
        title: Text('{{title}}'),
      ),
      body: Center(
        child: Text('{{description}}'),
      ),
    ){{else}}Container(
      child: Text('{{description}}'),
    ){{/if}};
  }
}
{{else}}
// {{description}}
class {{componentName}} {
  // Implementation for {{platform.name}}
}
{{/if}}
''');
  }

  /// ç”ŸæˆServiceæ¨¡æ¿
  Future<void> _generateServiceTemplates(
    String templatesDir,
    ScaffoldConfig config,
  ) async {
    final serviceFile = File(path.join(templatesDir, 'service.dart.template'));
    await serviceFile.writeAsString(r'''
{{#if subType.api}}
import 'dart:convert';
import 'package:http/http.dart' as http;

class {{serviceName}}Service {
  final String baseUrl;
  
  {{serviceName}}Service({required this.baseUrl});
  
  Future<Map<String, dynamic>> getData() async {
    final response = await http.get(Uri.parse('$baseUrl/{{endpoint}}'));
    
    if (response.statusCode == 200) {
      return json.decode(response.body);
    } else {
      throw Exception('Failed to load data');
    }
  }
}
{{else}}
class {{serviceName}}Service {
  // {{description}}
  
  Future<void> execute() async {
    // Implementation
  }
}
{{/if}}
''');
  }

  /// ç”Ÿæˆé…ç½®æ–‡ä»¶
  Future<void> _generateConfigFiles(
    String templatePath,
    ScaffoldConfig config,
  ) async {
    // ç”Ÿæˆpubspec.yaml
    final pubspecFile = File(path.join(templatePath, 'pubspec.yaml'));
    await pubspecFile.writeAsString(_generatePubspecYaml(config));

    // ç”Ÿæˆ.gitignore
    final gitignoreFile = File(path.join(templatePath, '.gitignore'));
    await gitignoreFile.writeAsString(_generateGitignore());

    // æ ¹æ®æ¡†æ¶ç±»å‹ç”Ÿæˆç‰¹å®šé…ç½®æ–‡ä»¶
    if (config.framework == TemplateFramework.flutter) {
      await _generateFlutterConfigFiles(templatePath, config);
    }
  }

  /// ç”ŸæˆFlutterç‰¹å®šé…ç½®æ–‡ä»¶
  Future<void> _generateFlutterConfigFiles(
    String templatePath,
    ScaffoldConfig config,
  ) async {
    // ç”Ÿæˆanalysis_options.yaml
    final analysisFile = File(path.join(templatePath, 'analysis_options.yaml'));
    await analysisFile.writeAsString(_generateAnalysisOptions());

    // ç”Ÿæˆl10n.yaml
    final l10nFile = File(path.join(templatePath, 'l10n.yaml'));
    await l10nFile.writeAsString(_generateL10nConfig());

    // ç”Ÿæˆbuild.yaml
    final buildFile = File(path.join(templatePath, 'build.yaml'));
    await buildFile.writeAsString(_generateBuildConfig());

    // ç”Ÿæˆl10n ARBæ–‡ä»¶
    await _generateL10nFiles(templatePath, config);

    // ç”Ÿæˆflutter_genèµ„æºæ–‡ä»¶
    await _generateFlutterGenAssets(templatePath, config);

    // ç”Ÿæˆmelos.yaml (å¦‚æœæ˜¯å¤šåŒ…é¡¹ç›®)
    if (config.templateType == TemplateType.full ||
        config.templateType == TemplateType.micro) {
      final melosFile = File(path.join(templatePath, 'melos.yaml'));
      await melosFile.writeAsString(_generateMelosConfig(config));
    }

    // ç”Ÿæˆflutter_gené…ç½®
    final flutterGenFile = File(path.join(templatePath, 'flutter_gen.yaml'));
    await flutterGenFile.writeAsString(_generateFlutterGenConfig());

    // ç”Ÿæˆshorenbirdé…ç½® (å¦‚æœæ˜¯å®Œæ•´åº”ç”¨)
    if (config.templateType == TemplateType.full) {
      final shorebirdFile = File(path.join(templatePath, 'shorebird.yaml'));
      await shorebirdFile.writeAsString(_generateShorebirdConfig(config));
    }
  }

  /// ç”Ÿæˆæ–‡æ¡£
  Future<void> _generateDocumentation(
    String templatePath,
    ScaffoldConfig config,
  ) async {
    // ç”ŸæˆREADME.md
    final readmeFile = File(path.join(templatePath, 'README.md'));
    await readmeFile.writeAsString(_generateReadme(config));

    // ç”ŸæˆCHANGELOG.md
    final changelogFile = File(path.join(templatePath, 'CHANGELOG.md'));
    await changelogFile.writeAsString(_generateChangelog(config));
  }

  /// ç”Ÿæˆæµ‹è¯•
  Future<void> _generateTests(
    String templatePath,
    ScaffoldConfig config,
  ) async {
    final testFile =
        File(path.join(templatePath, 'test', 'template_test.dart'));
    await testFile.writeAsString(_generateTestFile(config));
  }

  /// ç”Ÿæˆç¤ºä¾‹
  Future<void> _generateExamples(
    String templatePath,
    ScaffoldConfig config,
  ) async {
    final exampleFile =
        File(path.join(templatePath, 'example', 'example.dart'));
    await exampleFile.writeAsString(_generateExampleFile(config));
  }

  /// åˆå§‹åŒ–Git
  Future<void> _initializeGit(String templatePath) async {
    final result = await Process.run(
      'git',
      ['init'],
      workingDirectory: templatePath,
    );

    if (result.exitCode != 0) {
      cli_logger.Logger.warning('Gitåˆå§‹åŒ–å¤±è´¥: ${result.stderr}');
    }
  }

  /// ç”Ÿæˆæ¨¡æ¿ID
  String _generateTemplateId(String templateName) {
    return templateName.toLowerCase().replaceAll(RegExp('[^a-z0-9]'), '_');
  }

  /// è·å–æ¨¡æ¿æ–‡ä»¶åˆ—è¡¨
  Future<List<String>> _getTemplateFiles(
    String templatePath,
    ScaffoldConfig config,
  ) async {
    // ç®€åŒ–å®ç°ï¼Œè¿”å›åŸºç¡€æ–‡ä»¶åˆ—è¡¨
    return ['templates/main.dart.template'];
  }

  // å…¶ä»–æ¨¡æ¿ç±»å‹çš„ç”Ÿæˆæ–¹æ³•ï¼ˆç®€åŒ–å®ç°ï¼‰
  Future<void> _generateDataTemplates(
    String templatesDir,
    ScaffoldConfig config,
  ) async {
    // å®ç°æ•°æ®å±‚æ¨¡æ¿ç”Ÿæˆ
  }

  Future<void> _generateFullTemplates(
    String templatesDir,
    ScaffoldConfig config,
  ) async {
    // ç”Ÿæˆç°ä»£åŒ–Flutteråº”ç”¨çš„å®Œæ•´æ¨¡æ¿æ–‡ä»¶
    await _generateModernMainDart(templatesDir, config);
    await _generateAppWidget(templatesDir, config);
    await _generateRouterConfig(templatesDir, config);
    await _generateThemeConfig(templatesDir, config);
    await _generateProviders(templatesDir, config);
    await _generateModels(templatesDir, config);
    await _generateServices(templatesDir, config);
    await _generateScreens(templatesDir, config);
    await _generateWidgets(templatesDir, config);
    await _generateConstants(templatesDir, config);
    await _generateUtils(templatesDir, config);
  }

  Future<void> _generateSystemTemplates(
    String templatesDir,
    ScaffoldConfig config,
  ) async {
    // å®ç°ç³»ç»Ÿé…ç½®æ¨¡æ¿ç”Ÿæˆ
  }

  Future<void> _generateBasicTemplates(
    String templatesDir,
    ScaffoldConfig config,
  ) async {
    // å®ç°åŸºç¡€æ¨¡æ¿ç”Ÿæˆ
  }

  Future<void> _generateMicroTemplates(
    String templatesDir,
    ScaffoldConfig config,
  ) async {
    // å®ç°å¾®æœåŠ¡æ¨¡æ¿ç”Ÿæˆ
  }

  Future<void> _generatePluginTemplates(
    String templatesDir,
    ScaffoldConfig config,
  ) async {
    // å®ç°æ’ä»¶æ¨¡æ¿ç”Ÿæˆ
  }

  Future<void> _generateInfrastructureTemplates(
    String templatesDir,
    ScaffoldConfig config,
  ) async {
    // å®ç°åŸºç¡€è®¾æ–½æ¨¡æ¿ç”Ÿæˆ
  }

  // è¾…åŠ©æ–¹æ³•ç”¨äºç”Ÿæˆå„ç§é…ç½®æ–‡ä»¶å†…å®¹
  String _generateMetadataYaml(TemplateMetadata metadata) {
    return '''
name: ${metadata.name}
version: ${metadata.version}
author: ${metadata.author}
description: ${metadata.description}
type: ${metadata.type.name}
${metadata.subType != null ? 'subType: ${metadata.subType!.name}' : ''}
platform: ${metadata.platform.name}
framework: ${metadata.framework.name}
complexity: ${metadata.complexity.name}
maturity: ${metadata.maturity.name}
tags: ${metadata.tags}
dependencies: ${metadata.dependencies.map((d) => '${d.name}: ${d.version}').toList()}
''';
  }

  String _generatePubspecYaml(ScaffoldConfig config) {
    // æ ¹æ®æ¨¡æ¿ç±»å‹å’Œæ¡†æ¶ç¡®å®šä¾èµ–
    final dependencies = _generateDependencies(config);
    final devDependencies = _generateDevDependencies(config);

    return '''
name: ${config.templateName}
description: ${config.description}
version: ${config.version}
publish_to: 'none' # é˜²æ­¢æ„å¤–å‘å¸ƒ

environment:
  sdk: '>=3.0.0 <4.0.0'
  flutter: ">=3.10.0"

dependencies:
  flutter:
    sdk: flutter
${dependencies.map((dep) => '  $dep').join('\n')}

dev_dependencies:
  flutter_test:
    sdk: flutter
${devDependencies.map((dep) => '  $dep').join('\n')}

# Flutteré…ç½®
flutter:
  uses-material-design: true

  # èµ„æºé…ç½®
  assets:
    - assets/images/
    - assets/icons/

  # å­—ä½“é…ç½®
  fonts:
    - family: Roboto
      fonts:
        - asset: fonts/Roboto-Regular.ttf
        - asset: fonts/Roboto-Bold.ttf
          weight: 700

# ä»£ç ç”Ÿæˆé…ç½®
flutter_gen:
  output: lib/generated/
  line_length: 80
  integrations:
    flutter_svg: true
    flare_flutter: true
''';
  }

  String _generateGitignore() {
    return '''
# Files and directories created by pub
.dart_tool/
.packages
build/
pubspec.lock

# IDE files
.vscode/
.idea/
*.iml

# OS files
.DS_Store
Thumbs.db
''';
  }

  String _generateReadme(ScaffoldConfig config) {
    return '''
# ${config.templateName}

${config.description}

## ä½¿ç”¨æ–¹æ³•

1. å®‰è£…ä¾èµ–ï¼š
   ```bash
   dart pub get
   ```

2. ä½¿ç”¨æ¨¡æ¿ï¼š
   ```bash
   ming template generate ${config.templateName}
   ```

## ç‰¹æ€§

- ç±»å‹ï¼š${config.templateType.displayName}
- å¹³å°ï¼š${config.platform.name}
- æ¡†æ¶ï¼š${config.framework.name}
- å¤æ‚åº¦ï¼š${config.complexity.name}

## ä½œè€…

${config.author}

## è®¸å¯è¯

MIT License
''';
  }

  String _generateChangelog(ScaffoldConfig config) {
    return '''
# Changelog

## [${config.version}] - ${DateTime.now().toIso8601String().split('T')[0]}

### Added
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ${config.description}

### Features
- æ”¯æŒ${config.platform.name}å¹³å°
- åŸºäº${config.framework.name}æ¡†æ¶
- ${config.complexity.name}å¤æ‚åº¦ç­‰çº§
''';
  }

  String _generateTestFile(ScaffoldConfig config) {
    return '''
import 'package:test/test.dart';

void main() {
  group('${config.templateName} Template Tests', () {
    test('should generate correctly', () {
      // TODO: å®ç°æ¨¡æ¿æµ‹è¯•
      expect(true, isTrue);
    });
  });
}
''';
  }

  String _generateExampleFile(ScaffoldConfig config) {
    return '''
// ${config.templateName} ä½¿ç”¨ç¤ºä¾‹

void main() {
  print('${config.templateName} æ¨¡æ¿ç¤ºä¾‹');
  print('æè¿°: ${config.description}');
  print('ç±»å‹: ${config.templateType.displayName}');
}
''';
  }

  /// ç”Ÿæˆä¾èµ–åˆ—è¡¨
  List<String> _generateDependencies(ScaffoldConfig config) {
    final dependencies = <String>[];

    // åŸºç¡€ä¾èµ–
    if (config.framework == TemplateFramework.flutter) {
      // Flutteræ ¸å¿ƒä¾èµ–
      dependencies.addAll([
        'flutter_localizations:',
        '  sdk: flutter',
        '',
        '# çŠ¶æ€ç®¡ç†',
        'flutter_riverpod: ^2.4.9',
        'riverpod_annotation: ^2.3.3',
        '',
        '# è·¯ç”±å¯¼èˆª',
        'go_router: ^12.1.3',
        '',
        '# æ•°æ®ç±»ç”Ÿæˆ',
        'freezed_annotation: ^2.4.1',
        'json_annotation: ^4.8.1',
        '',
        '# ç½‘ç»œè¯·æ±‚',
        'dio: ^5.4.0',
        'retrofit: ^4.0.3',
        '',
        '# æœ¬åœ°å­˜å‚¨',
        'shared_preferences: ^2.2.2',
        'hive: ^2.2.3',
        'hive_flutter: ^1.1.0',
        '',
        '# UIç»„ä»¶',
        'flutter_svg: ^2.0.9',
        'cached_network_image: ^3.3.0',
        'shimmer: ^3.0.0',
        '',
        '# å·¥å…·åº“',
        'intl: ^0.19.0',
        'equatable: ^2.0.5',
        'uuid: ^4.2.1',
      ]);

      // æ ¹æ®æ¨¡æ¿ç±»å‹æ·»åŠ ç‰¹å®šä¾èµ–
      switch (config.templateType) {
        case TemplateType.ui:
          dependencies.addAll([
            '',
            '# UIç‰¹å®šä¾èµ–',
            'flutter_staggered_grid_view: ^0.7.0',
            'flutter_animate: ^4.3.0',
          ]);
        case TemplateType.full:
          dependencies.addAll([
            '',
            '# å®Œæ•´åº”ç”¨ä¾èµ–',
            'firebase_core: ^2.24.2',
            'firebase_auth: ^4.15.3',
            'cloud_firestore: ^4.13.6',
            'firebase_storage: ^11.5.6',
          ]);
        case TemplateType.micro:
          dependencies.addAll([
            '',
            '# å¾®æœåŠ¡ä¾èµ–',
            'shelf: ^1.4.1',
            'shelf_router: ^1.1.4',
            'shelf_cors_headers: ^0.1.5',
          ]);
        case TemplateType.service:
        case TemplateType.data:
        case TemplateType.system:
        case TemplateType.basic:
        case TemplateType.plugin:
        case TemplateType.infrastructure:
          // å…¶ä»–ç±»å‹ä½¿ç”¨åŸºç¡€ä¾èµ–
          break;
      }
    } else {
      // éFlutteré¡¹ç›®çš„åŸºç¡€ä¾èµ–
      dependencies.addAll([
        'args: ^2.4.2',
        'path: ^1.8.3',
        'yaml: ^3.1.2',
      ]);
    }

    return dependencies;
  }

  /// ç”Ÿæˆå¼€å‘ä¾èµ–åˆ—è¡¨
  List<String> _generateDevDependencies(ScaffoldConfig config) {
    final devDependencies = <String>[];

    if (config.framework == TemplateFramework.flutter) {
      devDependencies.addAll([
        '# ä»£ç ç”Ÿæˆ',
        'build_runner: ^2.4.7',
        'freezed: ^2.4.6',
        'json_serializable: ^6.7.1',
        'riverpod_generator: ^2.3.9',
        'retrofit_generator: ^8.0.6',
        '',
        '# èµ„æºç”Ÿæˆ',
        'flutter_gen_runner: ^5.4.0',
        '',
        '# æµ‹è¯•',
        'flutter_test:',
        '  sdk: flutter',
        'integration_test:',
        '  sdk: flutter',
        'mockito: ^5.4.4',
        'build_verify: ^3.1.0',
        '',
        '# ä»£ç è´¨é‡',
        'flutter_lints: ^3.0.1',
        'very_good_analysis: ^5.1.0',
        '',
        '# å·¥å…·',
        'flutter_launcher_icons: ^0.13.1',
        'flutter_native_splash: ^2.3.8',
      ]);

      // æ ¹æ®æ¨¡æ¿ç±»å‹æ·»åŠ ç‰¹å®šå¼€å‘ä¾èµ–
      switch (config.templateType) {
        case TemplateType.full:
          devDependencies.addAll([
            '',
            '# å®Œæ•´åº”ç”¨å¼€å‘å·¥å…·',
            'patrol: ^2.6.0',
            'golden_toolkit: ^0.15.0',
          ]);
        case TemplateType.ui:
        case TemplateType.service:
        case TemplateType.data:
        case TemplateType.system:
        case TemplateType.basic:
        case TemplateType.micro:
        case TemplateType.plugin:
        case TemplateType.infrastructure:
          // å…¶ä»–ç±»å‹ä½¿ç”¨åŸºç¡€å¼€å‘ä¾èµ–
          break;
      }
    } else {
      devDependencies.addAll([
        'test: ^1.24.9',
        'lints: ^3.0.0',
      ]);
    }

    return devDependencies;
  }

  /// ç”Ÿæˆanalysis_options.yamlé…ç½®
  String _generateAnalysisOptions() {
    return '''
# ä»£ç åˆ†æé…ç½®
include: package:very_good_analysis/analysis_options.yaml

analyzer:
  exclude:
    - "**/*.g.dart"
    - "**/*.freezed.dart"
    - "**/*.gr.dart"
    - "**/generated/**"
    - "build/**"
    - "lib/generated/**"

linter:
  rules:
    # è‡ªå®šä¹‰è§„åˆ™
    prefer_single_quotes: true
    sort_constructors_first: true
    sort_unnamed_constructors_first: true
    always_use_package_imports: true
    avoid_print: true
    prefer_const_constructors: true
    prefer_const_literals_to_create_immutables: true

    # ç¦ç”¨æŸäº›è§„åˆ™
    public_member_api_docs: false
    lines_longer_than_80_chars: false
''';
  }

  /// ç”Ÿæˆl10n.yamlé…ç½®
  String _generateL10nConfig() {
    return '''
# Flutterå›½é™…åŒ–é…ç½®
# æ›´å¤šä¿¡æ¯: https://docs.flutter.dev/development/accessibility-and-localization/internationalization

# ARBæ–‡ä»¶ç›®å½•
arb-dir: l10n

# æ¨¡æ¿ARBæ–‡ä»¶ï¼ˆè‹±è¯­ä½œä¸ºåŸºç¡€è¯­è¨€ï¼‰
template-arb-file: app_en.arb

# ç”Ÿæˆçš„æœ¬åœ°åŒ–æ–‡ä»¶å
output-localization-file: app_localizations.dart

# ç”Ÿæˆçš„æœ¬åœ°åŒ–ç±»å
output-class: AppLocalizations

# è¾“å‡ºç›®å½•
output-dir: lib/generated/l10n

# æ”¯æŒçš„è¯­è¨€åˆ—è¡¨ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
preferred-supported-locales: ["en", "zh", "ja", "ko", "es", "fr", "de", "ru", "ar", "hi"]

# å¤´æ–‡ä»¶ï¼ˆåŒ…å«ç‰ˆæƒä¿¡æ¯ç­‰ï¼‰
header-file: l10n/header.txt

# å†…è”å¤´ä¿¡æ¯
header: |
  /// Generated file. Do not edit.
  ///
  /// Original: {arb-file}
  /// To regenerate, run: `flutter gen-l10n`
  ///
  /// This file was automatically generated from ARB files.

# æ˜¯å¦ç”Ÿæˆå¯ç©ºçš„getter
nullable-getter: false

# æ˜¯å¦ä½¿ç”¨åˆæˆåŒ…
synthetic-package: false

# æ˜¯å¦ç”Ÿæˆæœªç¿»è¯‘æ¶ˆæ¯çš„è­¦å‘Š
untranslated-messages-file: l10n/untranslated.json

# æ˜¯å¦éªŒè¯ARBæ–‡ä»¶
validate-only: false

# æ˜¯å¦ç”Ÿæˆsetteræ–¹æ³•
generate-setters: false

# æ˜¯å¦ä½¿ç”¨è½¬ä¹‰åºåˆ—
use-escaping: true

# æ˜¯å¦ç”Ÿæˆæœ¬åœ°åŒ–å§”æ‰˜
generate-localization-delegate: true
''';
  }

  /// ç”Ÿæˆbuild.yamlé…ç½®
  String _generateBuildConfig() {
    return r'''
# Build Runneré…ç½® - ä¼ä¸šçº§ä»£ç ç”Ÿæˆ
# æ›´å¤šä¿¡æ¯: https://pub.dev/packages/build_runner

targets:
  $default:
    builders:
      # === æ•°æ®ç±»ç”Ÿæˆå™¨ ===

      # Freezed - ä¸å¯å˜æ•°æ®ç±»ç”Ÿæˆ
      freezed:
        enabled: true
        options:
          # ç”ŸæˆcopyWithæ–¹æ³•
          copy_with: true
          # ç”Ÿæˆequalå’ŒhashCode
          equal: true
          # ç”ŸæˆtoStringæ–¹æ³•
          to_string: true
          # ç”Ÿæˆwhen/mapæ–¹æ³•
          when: true
          map: true
          # ç”ŸæˆmaybeWhen/maybeMapæ–¹æ³•
          maybe_when: true
          maybe_map: true
          # æ·»åŠ assertæ£€æŸ¥
          assert_size: true
          # ç”Ÿæˆæ„é€ å‡½æ•°é‡å®šå‘
          constructor_redirect: true
          # è‡ªå®šä¹‰toStringæ ¼å¼
          to_string_override: false
          # ç”Ÿæˆå¯å˜ç‰ˆæœ¬
          mutable: false
        generate_for:
          - lib/src/models/**
          - lib/src/entities/**
          - lib/src/data/**
          - lib/src/domain/**
        exclude:
          - "**/*.g.dart"
          - "**/*.freezed.dart"
          - "**/generated/**"

      # JSON Serializable - JSONåºåˆ—åŒ–ä»£ç ç”Ÿæˆ
      json_serializable:
        enabled: true
        options:
          # ç”ŸæˆtoJsonæ–¹æ³•
          explicit_to_json: true
          # å­—æ®µé‡å‘½åç­–ç•¥
          field_rename: snake
          # åŒ…å«nullå­—æ®µ
          include_if_null: false
          # ç”ŸæˆfromJsonæ„é€ å‡½æ•°
          create_factory: true
          # ç”ŸæˆtoJsonæ–¹æ³•
          create_to_json: true
          # æ£€æŸ¥å¿…éœ€å­—æ®µ
          checked: true
          # ç¦ç”¨æœªçŸ¥å­—æ®µ
          disallow_unrecognized_keys: false
          # ç”Ÿæˆæ³›å‹å·¥å‚
          generic_argument_factories: true
          # ä»»æ„Mapé”®ç±»å‹
          any_map: false
          # å¿½ç•¥æœªçŸ¥å­—æ®µ
          ignore_unannotated: false
        generate_for:
          - lib/src/models/**
          - lib/src/entities/**
          - lib/src/data/**
          - lib/src/api/**
        exclude:
          - "**/*.freezed.dart"
          - "**/generated/**"

      # === çŠ¶æ€ç®¡ç†ç”Ÿæˆå™¨ ===

      # Riverpod Generator - çŠ¶æ€ç®¡ç†ä»£ç ç”Ÿæˆ
      riverpod_generator:
        enabled: true
        options:
          # ç”ŸæˆkeepAlive
          keep_alive: true
          # ç”Ÿæˆä¾èµ–
          dependencies: true
          # ç”Ÿæˆfamily
          family: true
          # ç”ŸæˆautoDispose
          auto_dispose: true
          # ç”Ÿæˆç¼“å­˜
          cache: true
          # ç”Ÿæˆè°ƒè¯•åç§°
          debug_name: true
          # ç”Ÿæˆæ–‡æ¡£
          documentation: true
        generate_for:
          - lib/src/providers/**
          - lib/src/services/**
          - lib/src/repositories/**
          - lib/src/controllers/**
          - lib/src/notifiers/**
        exclude:
          - "**/*.g.dart"
          - "**/generated/**"

      # === è·¯ç”±ç”Ÿæˆå™¨ ===

      # Go Router Generator - è·¯ç”±ä»£ç ç”Ÿæˆ
      go_router_builder:
        enabled: true
        options:
          # ç”Ÿæˆç±»å‹å®‰å…¨è·¯ç”±
          type_safe: true
          # ç”Ÿæˆè·¯ç”±åç§°
          generate_route_names: true
          # ç”Ÿæˆè·¯ç”±è·¯å¾„
          generate_route_paths: true
          # ç”Ÿæˆå¯¼èˆªæ‰©å±•
          generate_navigation_extensions: true
        generate_for:
          - lib/src/router/**
          - lib/src/navigation/**
        exclude:
          - "**/*.g.dart"

      # === APIç”Ÿæˆå™¨ ===

      # Retrofit Generator - HTTPå®¢æˆ·ç«¯ä»£ç ç”Ÿæˆ
      retrofit_generator:
        enabled: true
        options:
          # ç”Ÿæˆé¢å¤–æ–¹æ³•
          generate_extra_methods: true
          # ç”ŸæˆæŸ¥è¯¢å‚æ•°
          generate_query_parameters: true
          # ç”Ÿæˆè¯·æ±‚ä½“
          generate_request_body: true
          # ç”Ÿæˆå“åº”ç±»å‹
          generate_response_type: true
        generate_for:
          - lib/src/api/**
          - lib/src/services/**
        exclude:
          - "**/*.g.dart"

      # === ä¾èµ–æ³¨å…¥ç”Ÿæˆå™¨ ===

      # Injectable Generator - ä¾èµ–æ³¨å…¥ä»£ç ç”Ÿæˆ
      injectable_generator:
        enabled: true
        options:
          # ç”Ÿæˆå•ä¾‹
          singleton: true
          # ç”Ÿæˆæ‡’åŠ è½½å•ä¾‹
          lazy_singleton: true
          # ç”Ÿæˆå·¥å‚
          factory: true
          # ç”Ÿæˆç¯å¢ƒé…ç½®
          environments: true
          # è‡ªåŠ¨æ³¨å†Œ
          auto_register: true
        generate_for:
          - lib/src/services/**
          - lib/src/repositories/**
          - lib/src/data/**
          - lib/src/core/**
        exclude:
          - "**/*.g.dart"
          - "**/generated/**"

# === å…¨å±€é…ç½® ===
global_options:
  # æ„å»ºæ‰©å±•é…ç½®
  build_extensions:
    ".dart":
      - ".g.dart"
      - ".freezed.dart"
      - ".gr.dart"
      - ".config.dart"
      - ".mocks.dart"
    ".json":
      - ".g.dart"

  # æ„å»ºè¿‡æ»¤å™¨
  build_filters:
    exclude:
      - "**/*.g.dart"
      - "**/*.freezed.dart"
      - "**/*.gr.dart"
      - "**/*.config.dart"
      - "**/*.mocks.dart"
      - "**/generated/**"
      - "**/.dart_tool/**"
      - "**/build/**"

  # æ€§èƒ½é…ç½®
  performance:
    # å¯ç”¨å¢é‡æ„å»º
    incremental: true
    # å¹¶è¡Œæ„å»º
    parallel: true
    # æœ€å¤§å¹¶è¡Œæ•°
    max_concurrency: 4
    # ç¼“å­˜é…ç½®
    cache:
      enabled: true
      max_size: "500MB"
      ttl: "7d"
''';
  }

  /// ç”Ÿæˆmelos.yamlé…ç½®
  String _generateMelosConfig(ScaffoldConfig config) {
    return '''
# Melosé…ç½® - ä¼ä¸šçº§Monorepoç®¡ç†
# æ›´å¤šä¿¡æ¯: https://melos.invertase.dev/

name: ${config.templateName}
repository: https://github.com/your-org/${config.templateName}

# åŒ…é…ç½®
packages:
  - packages/**
  - apps/**
  - modules/**
  - plugins/**

# å¿½ç•¥çš„åŒ…
ignore:
  - "**/example/**"
  - "**/build/**"
  - "**/.dart_tool/**"

# å‘½ä»¤é…ç½®
command:
  version:
    # ç‰ˆæœ¬ç®¡ç†
    updateGitTagRefs: true
    workspaceChangelog: true
    linkToCommits: true
    workspaceChangelogHeader: |
      # Changelog

      All notable changes to this project will be documented in this file.

    # ç‰ˆæœ¬ç­–ç•¥
    strategy: all-changed

    # æäº¤æ¶ˆæ¯æ¨¡æ¿
    message: |
      chore(release): publish packages

      {new_package_versions}

  bootstrap:
    # ä¾èµ–ç®¡ç†
    runPubGetInParallel: true
    usePubspecOverrides: true

    # ç¯å¢ƒé…ç½®
    environment:
      sdk: ">=3.0.0 <4.0.0"
      flutter: ">=3.10.0"

# è„šæœ¬é…ç½®
scripts:
  # === å¼€å‘è„šæœ¬ ===

  # ä»£ç ç”Ÿæˆ
  generate:
    run: |
      echo "ğŸ”„ å¼€å§‹ä»£ç ç”Ÿæˆ..."
      melos exec -c 1 --fail-fast -- "dart run build_runner build --delete-conflicting-outputs"
      echo "âœ… ä»£ç ç”Ÿæˆå®Œæˆ"
    description: è¿è¡Œæ‰€æœ‰åŒ…çš„ä»£ç ç”Ÿæˆ

  # ä»£ç ç”Ÿæˆï¼ˆç›‘å¬æ¨¡å¼ï¼‰
  generate:watch:
    run: |
      echo "ğŸ‘€ å¯åŠ¨ä»£ç ç”Ÿæˆç›‘å¬æ¨¡å¼..."
      melos exec -c 1 --fail-fast -- "dart run build_runner watch --delete-conflicting-outputs"
    description: ç›‘å¬æ¨¡å¼è¿è¡Œä»£ç ç”Ÿæˆ

  # === è´¨é‡ä¿è¯è„šæœ¬ ===

  # ä»£ç åˆ†æ
  analyze:
    run: |
      echo "ğŸ” å¼€å§‹ä»£ç åˆ†æ..."
      melos exec --fail-fast -- "dart analyze . --fatal-infos"
      echo "âœ… ä»£ç åˆ†æå®Œæˆ"
    description: åˆ†ææ‰€æœ‰åŒ…çš„ä»£ç è´¨é‡

  # ä»£ç æ ¼å¼åŒ–
  format:
    run: |
      echo "ğŸ¨ å¼€å§‹ä»£ç æ ¼å¼åŒ–..."
      melos exec --fail-fast -- "dart format . --set-exit-if-changed"
      echo "âœ… ä»£ç æ ¼å¼åŒ–å®Œæˆ"
    description: æ ¼å¼åŒ–æ‰€æœ‰åŒ…çš„ä»£ç 

  # ä»£ç æ ¼å¼åŒ–ï¼ˆä¿®å¤æ¨¡å¼ï¼‰
  format:fix:
    run: |
      echo "ğŸ”§ å¼€å§‹ä¿®å¤ä»£ç æ ¼å¼..."
      melos exec --fail-fast -- "dart format . --fix"
      echo "âœ… ä»£ç æ ¼å¼ä¿®å¤å®Œæˆ"
    description: è‡ªåŠ¨ä¿®å¤ä»£ç æ ¼å¼é—®é¢˜

  # === æµ‹è¯•è„šæœ¬ ===

  # å•å…ƒæµ‹è¯•
  test:
    run: |
      echo "ğŸ§ª å¼€å§‹è¿è¡Œå•å…ƒæµ‹è¯•..."
      melos exec --fail-fast --dir-exists=test -- "dart test --coverage=coverage"
      echo "âœ… å•å…ƒæµ‹è¯•å®Œæˆ"
    description: è¿è¡Œæ‰€æœ‰åŒ…çš„å•å…ƒæµ‹è¯•

  # æµ‹è¯•è¦†ç›–ç‡
  test:coverage:
    run: |
      echo "ğŸ“Š å¼€å§‹ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š..."
      melos exec --fail-fast --dir-exists=test -- "dart test --coverage=coverage"
      melos exec --fail-fast --dir-exists=coverage -- "genhtml coverage/lcov.info -o coverage/html"
      echo "âœ… æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šç”Ÿæˆå®Œæˆ"
    description: ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š

  # é›†æˆæµ‹è¯•
  test:integration:
    run: |
      echo "ğŸ”— å¼€å§‹è¿è¡Œé›†æˆæµ‹è¯•..."
      melos exec --fail-fast --dir-exists=integration_test -- "flutter test integration_test"
      echo "âœ… é›†æˆæµ‹è¯•å®Œæˆ"
    description: è¿è¡Œé›†æˆæµ‹è¯•

  # === æ„å»ºè„šæœ¬ ===

  # æ„å»ºæ‰€æœ‰åŒ…
  build:
    run: |
      echo "ğŸ—ï¸ å¼€å§‹æ„å»ºæ‰€æœ‰åŒ…..."
      melos exec --fail-fast --flutter -- "flutter build apk --release"
      echo "âœ… æ„å»ºå®Œæˆ"
    description: æ„å»ºæ‰€æœ‰Flutteråº”ç”¨

  # æ¸…ç†æ„å»ºäº§ç‰©
  clean:
    run: |
      echo "ğŸ§¹ å¼€å§‹æ¸…ç†æ„å»ºäº§ç‰©..."
      melos exec --fail-fast -- "dart clean"
      melos exec --fail-fast --flutter -- "flutter clean"
      echo "âœ… æ¸…ç†å®Œæˆ"
    description: æ¸…ç†æ‰€æœ‰åŒ…çš„æ„å»ºäº§ç‰©

  # === ä¾èµ–ç®¡ç†è„šæœ¬ ===

  # è·å–ä¾èµ–
  get:
    run: |
      echo "ğŸ“¦ å¼€å§‹è·å–ä¾èµ–..."
      melos bootstrap
      echo "âœ… ä¾èµ–è·å–å®Œæˆ"
    description: è·å–æ‰€æœ‰åŒ…çš„ä¾èµ–

  # å‡çº§ä¾èµ–
  upgrade:
    run: |
      echo "â¬†ï¸ å¼€å§‹å‡çº§ä¾èµ–..."
      melos exec --fail-fast -- "dart pub upgrade"
      echo "âœ… ä¾èµ–å‡çº§å®Œæˆ"
    description: å‡çº§æ‰€æœ‰åŒ…çš„ä¾èµ–

  # æ£€æŸ¥è¿‡æœŸä¾èµ–
  outdated:
    run: |
      echo "ğŸ“… æ£€æŸ¥è¿‡æœŸä¾èµ–..."
      melos exec --fail-fast -- "dart pub outdated"
    description: æ£€æŸ¥æ‰€æœ‰åŒ…çš„è¿‡æœŸä¾èµ–

# IDEé…ç½®
ide:
  intellij:
    enabled: true
    moduleFileExtensions: ["dart", "yaml"]

# å¼€å‘ä¾èµ–
dev_dependencies:
  melos: ^3.2.0
  very_good_analysis: ^5.1.0
''';
  }

  /// ç”Ÿæˆflutter_gen.yamlé…ç½®
  String _generateFlutterGenConfig() {
    return r'''
# Flutter Gené…ç½® - ä¼ä¸šçº§èµ„æºç”Ÿæˆå’Œç±»å‹å®‰å…¨
# æ›´å¤šä¿¡æ¯: https://pub.dev/packages/flutter_gen

flutter_gen:
  # è¾“å‡ºç›®å½•
  output: lib/generated/

  # ä»£ç æ ¼å¼é…ç½®
  line_length: 80

  # æ˜¯å¦ç”Ÿæˆnull safetyä»£ç 
  null_safety: true

  # æ˜¯å¦ç”Ÿæˆæ–‡æ¡£æ³¨é‡Š
  generate_docs: true

  # ç¬¬ä¸‰æ–¹åº“é›†æˆé…ç½®
  integrations:
    # SVGå›¾ç‰‡æ”¯æŒ
    flutter_svg: true

    # FlareåŠ¨ç”»æ”¯æŒ
    flare_flutter: true

    # RiveåŠ¨ç”»æ”¯æŒ
    rive: true

    # LottieåŠ¨ç”»æ”¯æŒ
    lottie: true

    # ç½‘ç»œå›¾ç‰‡ç¼“å­˜
    cached_network_image: true

    # å›¾ç‰‡å‹ç¼©
    flutter_image_compress: true

  # èµ„æºæ–‡ä»¶é…ç½®
  assets:
    # æ˜¯å¦å¯ç”¨èµ„æºç”Ÿæˆ
    enabled: true

    # æ˜¯å¦ç”ŸæˆåŒ…å‚æ•°
    package_parameter_enabled: false

    # å‘½åé£æ ¼
    style: dot-delimiter  # dot-delimiter, camel-case, snake-case

    # èµ„æºç±»å
    class_name: "Assets"

    # æ˜¯å¦ç”Ÿæˆå¸¸é‡
    generate_const: true

    # æ˜¯å¦ç”Ÿæˆæ‰©å±•æ–¹æ³•
    generate_extensions: true

    # æ’é™¤çš„æ–‡ä»¶æ¨¡å¼
    exclude:
      - "**/.DS_Store"
      - "**/Thumbs.db"
      - "**/*.tmp"
      - "**/*.temp"

    # å›¾ç‰‡èµ„æºç‰¹æ®Šé…ç½®
    images:
      # æ˜¯å¦ç”Ÿæˆå›¾ç‰‡å°ºå¯¸ä¿¡æ¯
      generate_size_info: true

      # æ”¯æŒçš„å›¾ç‰‡æ ¼å¼
      supported_formats:
        - png
        - jpg
        - jpeg
        - gif
        - webp
        - svg

      # å›¾ç‰‡å‹ç¼©é…ç½®
      compression:
        enabled: true
        quality: 85

      # å¤šåˆ†è¾¨ç‡æ”¯æŒ
      density_aware: true

      # å›¾ç‰‡é¢„åŠ è½½
      preload_images: false

  # å­—ä½“é…ç½®
  fonts:
    # æ˜¯å¦å¯ç”¨å­—ä½“ç”Ÿæˆ
    enabled: true

    # å­—ä½“ç±»å
    class_name: "FontFamily"

    # æ˜¯å¦ç”Ÿæˆå­—ä½“æƒé‡å¸¸é‡
    generate_font_weights: true

    # æ˜¯å¦ç”Ÿæˆå­—ä½“æ ·å¼å¸¸é‡
    generate_font_styles: true

    # å­—ä½“æ–‡ä»¶é…ç½®
    font_files:
      # æ˜¯å¦ç”Ÿæˆå­—ä½“æ–‡ä»¶è·¯å¾„å¸¸é‡
      generate_paths: true

      # æ”¯æŒçš„å­—ä½“æ ¼å¼
      supported_formats:
        - ttf
        - otf
        - woff
        - woff2

    # è‡ªå®šä¹‰å­—ä½“é…ç½®
    custom_fonts:
      # æ˜¯å¦è‡ªåŠ¨æ£€æµ‹å­—ä½“æƒé‡
      auto_detect_weights: true

      # é»˜è®¤å­—ä½“æƒé‡
      default_weight: 400

      # å­—ä½“å›é€€é…ç½®
      fallback_fonts:
        - "Roboto"
        - "Arial"
        - "sans-serif"

  # é¢œè‰²é…ç½®
  colors:
    # æ˜¯å¦å¯ç”¨é¢œè‰²ç”Ÿæˆ
    enabled: true

    # é¢œè‰²ç±»å
    class_name: "AppColors"

    # é¢œè‰²è¾“å…¥æ–‡ä»¶
    inputs:
      - assets/colors/colors.xml
      - assets/colors/material_colors.xml
      - assets/colors/brand_colors.json

    # é¢œè‰²æ ¼å¼é…ç½®
    formats:
      # æ”¯æŒçš„é¢œè‰²æ ¼å¼
      supported:
        - hex
        - rgb
        - argb
        - hsl
        - hsv

      # é»˜è®¤è¾“å‡ºæ ¼å¼
      default_output: hex

    # é¢œè‰²ä¸»é¢˜é…ç½®
    themes:
      # æ˜¯å¦ç”Ÿæˆä¸»é¢˜ç›¸å…³é¢œè‰²
      generate_theme_colors: true

      # æ”¯æŒçš„ä¸»é¢˜
      supported_themes:
        - light
        - dark
        - high_contrast

      # ä¸»é¢˜é¢œè‰²æ˜ å°„
      theme_mapping:
        primary: "primary_color"
        secondary: "secondary_color"
        surface: "surface_color"
        background: "background_color"
        error: "error_color"

    # é¢œè‰²éªŒè¯
    validation:
      # æ˜¯å¦éªŒè¯é¢œè‰²å¯¹æ¯”åº¦
      check_contrast: true

      # æœ€å°å¯¹æ¯”åº¦è¦æ±‚
      min_contrast_ratio: 4.5

      # æ˜¯å¦æ£€æŸ¥æ— éšœç¢æ€§
      accessibility_check: true

  # æœ¬åœ°åŒ–èµ„æºé…ç½®
  localization:
    # æ˜¯å¦å¯ç”¨æœ¬åœ°åŒ–èµ„æºç”Ÿæˆ
    enabled: true

    # æœ¬åœ°åŒ–ç±»å
    class_name: "L10nAssets"

    # æ”¯æŒçš„è¯­è¨€
    supported_locales:
      - en
      - zh
      - ja
      - ko
      - es
      - fr
      - de
      - ru

    # æœ¬åœ°åŒ–èµ„æºè·¯å¾„
    assets_path: "assets/l10n/"

  # ä»£ç ç”Ÿæˆé…ç½®
  code_generation:
    # æ˜¯å¦ç”Ÿæˆæ„å»ºå™¨æ–¹æ³•
    generate_builders: true

    # æ˜¯å¦ç”Ÿæˆå·¥å‚æ–¹æ³•
    generate_factories: true

    # æ˜¯å¦ç”Ÿæˆæ‰©å±•æ–¹æ³•
    generate_extensions: true

    # æ˜¯å¦ç”Ÿæˆæ··å…¥ç±»
    generate_mixins: false

    # ä»£ç æ¨¡æ¿é…ç½®
    templates:
      # ç±»æ¨¡æ¿
      class_template: |
        /// Generated class for {class_name}
        ///
        /// This class provides type-safe access to {resource_type} resources.
        /// Generated by flutter_gen on {generation_time}.
        class {class_name} {{
          {class_name}._();
          {content}
        }}

      # å¸¸é‡æ¨¡æ¿
      const_template: |
        /// {description}
        static const {type} {name} = {value};

  # æ€§èƒ½ä¼˜åŒ–é…ç½®
  performance:
    # æ˜¯å¦å¯ç”¨æ‡’åŠ è½½
    lazy_loading: true

    # æ˜¯å¦å¯ç”¨ç¼“å­˜
    caching: true

    # ç¼“å­˜ç­–ç•¥
    cache_strategy: "memory"  # memory, disk, hybrid

    # æœ€å¤§ç¼“å­˜å¤§å°ï¼ˆMBï¼‰
    max_cache_size: 100

    # æ˜¯å¦é¢„åŠ è½½å…³é”®èµ„æº
    preload_critical: true

  # è°ƒè¯•é…ç½®
  debug:
    # æ˜¯å¦ç”Ÿæˆè°ƒè¯•ä¿¡æ¯
    generate_debug_info: true

    # æ˜¯å¦è¾“å‡ºè¯¦ç»†æ—¥å¿—
    verbose_logging: false

    # æ˜¯å¦ç”Ÿæˆèµ„æºä½¿ç”¨ç»Ÿè®¡
    generate_usage_stats: true

    # è°ƒè¯•è¾“å‡ºæ ¼å¼
    debug_output_format: "json"  # json, yaml, xml

  # éªŒè¯é…ç½®
  validation:
    # æ˜¯å¦éªŒè¯èµ„æºå®Œæ•´æ€§
    check_integrity: true

    # æ˜¯å¦æ£€æŸ¥é‡å¤èµ„æº
    check_duplicates: true

    # æ˜¯å¦éªŒè¯å‘½åè§„èŒƒ
    check_naming_convention: true

    # å‘½åè§„èŒƒ
    naming_convention:
      # èµ„æºåç§°æ¨¡å¼
      pattern: "^[a-z][a-z0-9_]*$"

      # æ˜¯å¦å…è®¸æ•°å­—å¼€å¤´
      allow_leading_digits: false

      # æ˜¯å¦å¼ºåˆ¶å°å†™
      force_lowercase: true
''';
  }

  /// ç”Ÿæˆshorenbird.yamlé…ç½®
  String _generateShorebirdConfig(ScaffoldConfig config) {
    return '''
# Shorebirdé…ç½® - ä¼ä¸šçº§ä»£ç æ¨é€å’Œçƒ­æ›´æ–°
# æ›´å¤šä¿¡æ¯: https://docs.shorebird.dev/

# åº”ç”¨æ ‡è¯†ç¬¦
app_id: ${config.templateName.toLowerCase().replaceAll('_', '-')}

# å¤šç¯å¢ƒé…ç½®
flavors:
  # å¼€å‘ç¯å¢ƒ
  development:
    app_id: ${config.templateName.toLowerCase().replaceAll('_', '-')}-dev
    description: "å¼€å‘ç¯å¢ƒ - ç”¨äºå†…éƒ¨æµ‹è¯•å’Œå¼€å‘"
    auto_update:
      enabled: true
      check_interval: 1800  # 30åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
      force_update: false
    rollback:
      enabled: true
      max_rollback_patches: 10

  # æµ‹è¯•ç¯å¢ƒ
  staging:
    app_id: ${config.templateName.toLowerCase().replaceAll('_', '-')}-staging
    description: "æµ‹è¯•ç¯å¢ƒ - ç”¨äºQAæµ‹è¯•å’Œé¢„å‘å¸ƒéªŒè¯"
    auto_update:
      enabled: true
      check_interval: 3600  # 1å°æ—¶æ£€æŸ¥ä¸€æ¬¡
      force_update: false
    rollback:
      enabled: true
      max_rollback_patches: 8

  # ç”Ÿäº§ç¯å¢ƒ
  production:
    app_id: ${config.templateName.toLowerCase().replaceAll('_', '-')}-prod
    description: "ç”Ÿäº§ç¯å¢ƒ - æ­£å¼å‘å¸ƒç‰ˆæœ¬"
    auto_update:
      enabled: true
      check_interval: 7200  # 2å°æ—¶æ£€æŸ¥ä¸€æ¬¡
      force_update: false
    rollback:
      enabled: true
      max_rollback_patches: 5

# å…¨å±€è‡ªåŠ¨æ›´æ–°é…ç½®
auto_update:
  # æ˜¯å¦å¯ç”¨è‡ªåŠ¨æ›´æ–°
  enabled: true

  # æ£€æŸ¥æ›´æ–°é—´éš”ï¼ˆç§’ï¼‰
  check_interval: 3600

  # æ˜¯å¦å¼ºåˆ¶æ›´æ–°
  force_update: false

  # æ›´æ–°ç­–ç•¥
  strategy: "background"  # background, immediate, manual

  # ç½‘ç»œæ¡ä»¶è¦æ±‚
  network_policy:
    wifi_only: false
    cellular_allowed: true
    roaming_allowed: false

  # ç”µæ± æ¡ä»¶è¦æ±‚
  battery_policy:
    min_battery_level: 20  # æœ€ä½ç”µé‡20%
    charging_required: false

  # ç”¨æˆ·ä½“éªŒé…ç½®
  user_experience:
    show_update_dialog: true
    allow_user_defer: true
    max_defer_count: 3

# å›æ»šé…ç½®
rollback:
  # æ˜¯å¦å¯ç”¨å›æ»šåŠŸèƒ½
  enabled: true

  # æœ€å¤§å›æ»šè¡¥ä¸æ•°é‡
  max_rollback_patches: 5

  # è‡ªåŠ¨å›æ»šæ¡ä»¶
  auto_rollback:
    enabled: true

    # å´©æºƒç‡é˜ˆå€¼ï¼ˆç™¾åˆ†æ¯”ï¼‰
    crash_rate_threshold: 5.0

    # ç›‘æ§æ—¶é—´çª—å£ï¼ˆåˆ†é’Ÿï¼‰
    monitoring_window: 30

    # æœ€å°æ ·æœ¬æ•°é‡
    min_sample_size: 100

  # æ‰‹åŠ¨å›æ»šç­–ç•¥
  manual_rollback:
    enabled: true
    require_confirmation: true
    admin_approval_required: false

# å‘å¸ƒé…ç½®
release:
  # å‘å¸ƒç­–ç•¥
  strategy: "staged"  # immediate, staged, manual

  # åˆ†é˜¶æ®µå‘å¸ƒé…ç½®
  staged_rollout:
    enabled: true

    # å‘å¸ƒé˜¶æ®µé…ç½®
    stages:
      - percentage: 1    # ç¬¬ä¸€é˜¶æ®µï¼š1%ç”¨æˆ·
        duration: 24     # æŒç»­24å°æ—¶
      - percentage: 5    # ç¬¬äºŒé˜¶æ®µï¼š5%ç”¨æˆ·
        duration: 48     # æŒç»­48å°æ—¶
      - percentage: 25   # ç¬¬ä¸‰é˜¶æ®µï¼š25%ç”¨æˆ·
        duration: 72     # æŒç»­72å°æ—¶
      - percentage: 100  # æœ€ç»ˆé˜¶æ®µï¼š100%ç”¨æˆ·

    # æš‚åœæ¡ä»¶
    pause_conditions:
      crash_rate_threshold: 2.0
      error_rate_threshold: 5.0
      negative_feedback_threshold: 10.0

  # A/Bæµ‹è¯•é…ç½®
  ab_testing:
    enabled: false
    test_percentage: 10  # 10%ç”¨æˆ·å‚ä¸A/Bæµ‹è¯•

# ç›‘æ§å’Œåˆ†æé…ç½®
monitoring:
  # æ€§èƒ½ç›‘æ§
  performance:
    enabled: true

    # å…³é”®æŒ‡æ ‡
    metrics:
      - app_start_time
      - memory_usage
      - cpu_usage
      - network_latency
      - crash_rate
      - error_rate

    # æŠ¥å‘Šé¢‘ç‡
    reporting_interval: 300  # 5åˆ†é’Ÿ

  # ç”¨æˆ·åé¦ˆ
  feedback:
    enabled: true
    collection_rate: 0.1  # 10%ç”¨æˆ·æ”¶é›†åé¦ˆ

  # å´©æºƒæŠ¥å‘Š
  crash_reporting:
    enabled: true
    include_user_data: false
    include_device_info: true

# å®‰å…¨é…ç½®
security:
  # ä»£ç ç­¾åéªŒè¯
  code_signing:
    enabled: true
    verify_signature: true

  # ä¼ è¾“åŠ å¯†
  encryption:
    enabled: true
    algorithm: "AES-256"

  # è®¿é—®æ§åˆ¶
  access_control:
    require_authentication: true
    allowed_domains: []
    blocked_domains: []

# ç¼“å­˜é…ç½®
cache:
  # è¡¥ä¸ç¼“å­˜
  patch_cache:
    enabled: true
    max_size_mb: 100
    ttl_hours: 168  # 7å¤©

  # å…ƒæ•°æ®ç¼“å­˜
  metadata_cache:
    enabled: true
    max_size_mb: 10
    ttl_hours: 24   # 1å¤©

# æ—¥å¿—é…ç½®
logging:
  # æ—¥å¿—çº§åˆ«
  level: "info"  # debug, info, warn, error

  # æ—¥å¿—è¾“å‡º
  outputs:
    - console
    - file

  # æ—¥å¿—æ–‡ä»¶é…ç½®
  file_config:
    max_size_mb: 50
    max_files: 5
    rotation: "daily"

# å¼€å‘è€…å·¥å…·é…ç½®
dev_tools:
  # è°ƒè¯•æ¨¡å¼
  debug_mode: false

  # æµ‹è¯•æ¨¡å¼
  test_mode: false

  # è¯¦ç»†æ—¥å¿—
  verbose_logging: false

  # æ€§èƒ½åˆ†æ
  profiling: false

# å…¼å®¹æ€§é…ç½®
compatibility:
  # æœ€ä½æ”¯æŒç‰ˆæœ¬
  min_app_version: "1.0.0"

  # æœ€ä½ç³»ç»Ÿç‰ˆæœ¬
  min_os_version:
    android: "21"  # Android 5.0
    ios: "12.0"    # iOS 12.0

  # è®¾å¤‡è¦æ±‚
  device_requirements:
    min_ram_mb: 1024
    min_storage_mb: 100
''';
  }

  /// ç”Ÿæˆç°ä»£åŒ–main.dart
  Future<void> _generateModernMainDart(
    String templatesDir,
    ScaffoldConfig config,
  ) async {
    final mainFile = File(path.join(templatesDir, 'main.dart.template'));
    await mainFile.writeAsString('''
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:flutter_localizations/flutter_localizations.dart';
import 'package:{{packageName}}/src/app.dart';
import 'package:{{packageName}}/src/core/providers/app_providers.dart';
import 'package:{{packageName}}/generated/l10n/app_localizations.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();

  // åˆå§‹åŒ–Firebase (å¦‚æœéœ€è¦)
  {{#if firebase}}
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  {{/if}}

  // åˆå§‹åŒ–Hive (å¦‚æœéœ€è¦)
  {{#if hive}}
  await Hive.initFlutter();
  {{/if}}

  runApp(
    ProviderScope(
      child: {{appName}}App(),
    ),
  );
}
''');
  }

  /// ç”ŸæˆApp Widget
  Future<void> _generateAppWidget(
    String templatesDir,
    ScaffoldConfig config,
  ) async {
    final appFile = File(path.join(templatesDir, 'app.dart.template'));
    await appFile.writeAsString('''
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:go_router/go_router.dart';
import 'package:flutter_localizations/flutter_localizations.dart';
import 'package:{{packageName}}/src/core/router/app_router.dart';
import 'package:{{packageName}}/src/core/theme/app_theme.dart';
import 'package:{{packageName}}/generated/l10n/app_localizations.dart';

class {{appName}}App extends ConsumerWidget {
  const {{appName}}App({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final router = ref.watch(appRouterProvider);
    final themeMode = ref.watch(themeModeProvider);

    return MaterialApp.router(
      title: '{{appTitle}}',
      debugShowCheckedModeBanner: false,

      // è·¯ç”±é…ç½®
      routerConfig: router,

      // ä¸»é¢˜é…ç½®
      theme: AppTheme.lightTheme,
      darkTheme: AppTheme.darkTheme,
      themeMode: themeMode,

      // å›½é™…åŒ–é…ç½®
      localizationsDelegates: const [
        AppLocalizations.delegate,
        GlobalMaterialLocalizations.delegate,
        GlobalWidgetsLocalizations.delegate,
        GlobalCupertinoLocalizations.delegate,
      ],
      supportedLocales: AppLocalizations.supportedLocales,
    );
  }
}
''');
  }

  /// ç”Ÿæˆè·¯ç”±é…ç½®
  Future<void> _generateRouterConfig(
    String templatesDir,
    ScaffoldConfig config,
  ) async {
    final routerFile =
        File(path.join(templatesDir, 'app_router.dart.template'));
    await routerFile.writeAsString(r'''
import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:{{packageName}}/src/screens/home/home_screen.dart';
import 'package:{{packageName}}/src/screens/settings/settings_screen.dart';
import 'package:{{packageName}}/src/screens/splash/splash_screen.dart';

// è·¯ç”±æä¾›è€…
final appRouterProvider = Provider<GoRouter>((ref) {
  return GoRouter(
    initialLocation: '/splash',
    routes: [
      // å¯åŠ¨é¡µ
      GoRoute(
        path: '/splash',
        name: 'splash',
        builder: (context, state) => const SplashScreen(),
      ),

      // ä¸»é¡µ
      GoRoute(
        path: '/home',
        name: 'home',
        builder: (context, state) => const HomeScreen(),
      ),

      // è®¾ç½®é¡µ
      GoRoute(
        path: '/settings',
        name: 'settings',
        builder: (context, state) => const SettingsScreen(),
      ),
    ],

    // é”™è¯¯é¡µé¢
    errorBuilder: (context, state) => Scaffold(
      body: Center(
        child: Text('é¡µé¢æœªæ‰¾åˆ°: \${state.location}'),
      ),
    ),
  );
});
''');
  }

  // ä¸´æ—¶ç®€åŒ–ç‰ˆæœ¬çš„å‰©ä½™æ–¹æ³•
  Future<void> _generateThemeConfig(
      String templatesDir, ScaffoldConfig config,) async {
    // TODO: å®ç°ä¸»é¢˜é…ç½®ç”Ÿæˆ
  }

  Future<void> _generateProviders(
      String templatesDir, ScaffoldConfig config,) async {
    // TODO: å®ç°Providersç”Ÿæˆ
  }

  Future<void> _generateModels(
      String templatesDir, ScaffoldConfig config,) async {
    // TODO: å®ç°Modelsç”Ÿæˆ
  }

  Future<void> _generateServices(
      String templatesDir, ScaffoldConfig config,) async {
    // TODO: å®ç°Servicesç”Ÿæˆ
  }

  Future<void> _generateScreens(
      String templatesDir, ScaffoldConfig config,) async {
    // TODO: å®ç°Screensç”Ÿæˆ
  }

  Future<void> _generateWidgets(
      String templatesDir, ScaffoldConfig config,) async {
    // TODO: å®ç°Widgetsç”Ÿæˆ
  }

  Future<void> _generateConstants(
      String templatesDir, ScaffoldConfig config,) async {
    // TODO: å®ç°Constantsç”Ÿæˆ
  }

  Future<void> _generateUtils(
      String templatesDir, ScaffoldConfig config,) async {
    // TODO: å®ç°Utilsç”Ÿæˆ
  }

  /// ç”Ÿæˆl10nå›½é™…åŒ–æ–‡ä»¶
  Future<void> _generateL10nFiles(
      String templatePath, ScaffoldConfig config,) async {
    // åˆ›å»ºl10nç›®å½•
    final l10nDir = Directory(path.join(templatePath, 'l10n'));
    await l10nDir.create(recursive: true);

    // ç”Ÿæˆheader.txtæ–‡ä»¶
    final headerFile = File(path.join(l10nDir.path, 'header.txt'));
    await headerFile.writeAsString(_generateL10nHeader(config));

    // ç”Ÿæˆè‹±è¯­ARBæ–‡ä»¶ï¼ˆæ¨¡æ¿æ–‡ä»¶ï¼‰
    final enArbFile = File(path.join(l10nDir.path, 'app_en.arb'));
    await enArbFile.writeAsString(_generateEnglishArb(config));

    // ç”Ÿæˆä¸­æ–‡ARBæ–‡ä»¶
    final zhArbFile = File(path.join(l10nDir.path, 'app_zh.arb'));
    await zhArbFile.writeAsString(_generateChineseArb(config));
  }

  /// ç”Ÿæˆl10nå¤´æ–‡ä»¶
  String _generateL10nHeader(ScaffoldConfig config) {
    return '''
Generated by Ming Status CLI Template Generator
Project: ${config.templateName}
Author: ${config.author}
Generated: ${DateTime.now().toIso8601String()}

This file contains copyright and license information for generated localization files.
''';
  }

  /// ç”Ÿæˆè‹±è¯­ARBæ–‡ä»¶
  String _generateEnglishArb(ScaffoldConfig config) {
    return '''
{
  "@@locale": "en",
  "@@last_modified": "${DateTime.now().toIso8601String()}",
  "@@author": "${config.author}",

  "appTitle": "${config.templateName}",
  "@appTitle": {
    "description": "The title of the application"
  },

  "welcome": "Welcome",
  "@welcome": {
    "description": "Welcome message"
  },

  "hello": "Hello",
  "@hello": {
    "description": "Greeting message"
  },

  "helloUser": "Hello, {name}!",
  "@helloUser": {
    "description": "Personalized greeting message",
    "placeholders": {
      "name": {
        "type": "String",
        "example": "John"
      }
    }
  },

  "settings": "Settings",
  "@settings": {
    "description": "Settings page title"
  },

  "language": "Language",
  "@language": {
    "description": "Language selection label"
  },

  "theme": "Theme",
  "@theme": {
    "description": "Theme selection label"
  },

  "lightTheme": "Light",
  "@lightTheme": {
    "description": "Light theme option"
  },

  "darkTheme": "Dark",
  "@darkTheme": {
    "description": "Dark theme option"
  },

  "systemTheme": "System",
  "@systemTheme": {
    "description": "System theme option"
  },

  "save": "Save",
  "@save": {
    "description": "Save button text"
  },

  "cancel": "Cancel",
  "@cancel": {
    "description": "Cancel button text"
  },

  "ok": "OK",
  "@ok": {
    "description": "OK button text"
  },

  "error": "Error",
  "@error": {
    "description": "Error message title"
  },

  "loading": "Loading...",
  "@loading": {
    "description": "Loading indicator text"
  },

  "retry": "Retry",
  "@retry": {
    "description": "Retry button text"
  },

  "itemCount": "{count, plural, =0{No items} =1{1 item} other{{count} items}}",
  "@itemCount": {
    "description": "Number of items with pluralization",
    "placeholders": {
      "count": {
        "type": "int",
        "format": "compact"
      }
    }
  }
}
''';
  }

  /// ç”Ÿæˆä¸­æ–‡ARBæ–‡ä»¶
  String _generateChineseArb(ScaffoldConfig config) {
    return '''
{
  "@@locale": "zh",
  "@@last_modified": "${DateTime.now().toIso8601String()}",
  "@@author": "${config.author}",

  "appTitle": "${config.templateName}",
  "welcome": "æ¬¢è¿",
  "hello": "ä½ å¥½",
  "helloUser": "ä½ å¥½ï¼Œ{name}ï¼",
  "settings": "è®¾ç½®",
  "language": "è¯­è¨€",
  "theme": "ä¸»é¢˜",
  "lightTheme": "æµ…è‰²",
  "darkTheme": "æ·±è‰²",
  "systemTheme": "è·Ÿéšç³»ç»Ÿ",
  "save": "ä¿å­˜",
  "cancel": "å–æ¶ˆ",
  "ok": "ç¡®å®š",
  "error": "é”™è¯¯",
  "loading": "åŠ è½½ä¸­...",
  "retry": "é‡è¯•",
  "itemCount": "{count, plural, =0{æ²¡æœ‰é¡¹ç›®} other{{count} ä¸ªé¡¹ç›®}}"
}
''';
  }

  /// ç”Ÿæˆflutter_genèµ„æºæ–‡ä»¶
  Future<void> _generateFlutterGenAssets(
      String templatePath, ScaffoldConfig config,) async {
    // åˆ›å»ºassetsç›®å½•ç»“æ„
    await _createAssetsDirectories(templatePath);

    // ç”Ÿæˆé¢œè‰²èµ„æºæ–‡ä»¶
    await _generateColorAssets(templatePath, config);

    // ç”Ÿæˆç¤ºä¾‹å›¾ç‰‡èµ„æº
    await _generateImageAssets(templatePath, config);

    // ç”Ÿæˆå­—ä½“èµ„æº
    await _generateFontAssets(templatePath, config);
  }

  /// åˆ›å»ºèµ„æºç›®å½•ç»“æ„
  Future<void> _createAssetsDirectories(String templatePath) async {
    final directories = [
      'assets',
      'assets/images',
      'assets/icons',
      'assets/fonts',
      'assets/colors',
      'assets/l10n',
    ];

    for (final dir in directories) {
      final directory = Directory(path.join(templatePath, dir));
      await directory.create(recursive: true);
    }
  }

  /// ç”Ÿæˆé¢œè‰²èµ„æºæ–‡ä»¶
  Future<void> _generateColorAssets(
      String templatePath, ScaffoldConfig config,) async {
    // ç”Ÿæˆcolors.xmlæ–‡ä»¶
    final colorsXmlFile =
        File(path.join(templatePath, 'assets', 'colors', 'colors.xml'));
    await colorsXmlFile.writeAsString('''
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <!-- ä¸»è‰²è°ƒ -->
    <color name="primary_color">#2196F3</color>
    <color name="primary_variant">#1976D2</color>
    <color name="secondary_color">#03DAC6</color>
    <color name="secondary_variant">#018786</color>

    <!-- è¡¨é¢é¢œè‰² -->
    <color name="surface_color">#FFFFFF</color>
    <color name="background_color">#FAFAFA</color>
    <color name="error_color">#B00020</color>

    <!-- æ–‡æœ¬é¢œè‰² -->
    <color name="on_primary">#FFFFFF</color>
    <color name="on_secondary">#000000</color>
    <color name="on_surface">#000000</color>
    <color name="on_background">#000000</color>
    <color name="on_error">#FFFFFF</color>

    <!-- æ·±è‰²ä¸»é¢˜é¢œè‰² -->
    <color name="dark_primary_color">#BB86FC</color>
    <color name="dark_primary_variant">#3700B3</color>
    <color name="dark_secondary_color">#03DAC6</color>
    <color name="dark_surface_color">#121212</color>
    <color name="dark_background_color">#121212</color>

    <!-- åŠŸèƒ½é¢œè‰² -->
    <color name="success_color">#4CAF50</color>
    <color name="warning_color">#FF9800</color>
    <color name="info_color">#2196F3</color>

    <!-- ç°åº¦é¢œè‰² -->
    <color name="grey_50">#FAFAFA</color>
    <color name="grey_100">#F5F5F5</color>
    <color name="grey_200">#EEEEEE</color>
    <color name="grey_300">#E0E0E0</color>
    <color name="grey_400">#BDBDBD</color>
    <color name="grey_500">#9E9E9E</color>
    <color name="grey_600">#757575</color>
    <color name="grey_700">#616161</color>
    <color name="grey_800">#424242</color>
    <color name="grey_900">#212121</color>
</resources>
''');

    // ç”ŸæˆMaterial Designé¢œè‰²æ–‡ä»¶
    final materialColorsXmlFile = File(
        path.join(templatePath, 'assets', 'colors', 'material_colors.xml'),);
    await materialColorsXmlFile.writeAsString('''
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <!-- Material Design 3.0 é¢œè‰²ç³»ç»Ÿ -->

    <!-- å“ç‰Œé¢œè‰² -->
    <color name="brand_primary">#6750A4</color>
    <color name="brand_secondary">#625B71</color>
    <color name="brand_tertiary">#7D5260</color>

    <!-- ä¸­æ€§é¢œè‰² -->
    <color name="neutral_10">#1C1B1F</color>
    <color name="neutral_20">#313033</color>
    <color name="neutral_30">#484649</color>
    <color name="neutral_40">#605D62</color>
    <color name="neutral_50">#787579</color>
    <color name="neutral_60">#939094</color>
    <color name="neutral_70">#AEA9AE</color>
    <color name="neutral_80">#CAC4C9</color>
    <color name="neutral_90">#E6E0E5</color>
    <color name="neutral_95">#F3EDF2</color>
    <color name="neutral_99">#FFFBFE</color>

    <!-- ä¸­æ€§å˜ä½“é¢œè‰² -->
    <color name="neutral_variant_10">#1D1A22</color>
    <color name="neutral_variant_20">#322F37</color>
    <color name="neutral_variant_30">#49454F</color>
    <color name="neutral_variant_40">#605D66</color>
    <color name="neutral_variant_50">#79747E</color>
    <color name="neutral_variant_60">#938F99</color>
    <color name="neutral_variant_70">#AEA9B4</color>
    <color name="neutral_variant_80">#CAC4D0</color>
    <color name="neutral_variant_90">#E7E0EC</color>
    <color name="neutral_variant_95">#F5EEFA</color>
    <color name="neutral_variant_99">#FFFBFE</color>
</resources>
''');

    // ç”Ÿæˆå“ç‰Œé¢œè‰²JSONæ–‡ä»¶
    final brandColorsJsonFile =
        File(path.join(templatePath, 'assets', 'colors', 'brand_colors.json'));
    await brandColorsJsonFile.writeAsString('''
{
  "brand": {
    "primary": "#6750A4",
    "secondary": "#625B71",
    "tertiary": "#7D5260",
    "accent": "#03DAC6"
  },
  "semantic": {
    "success": "#4CAF50",
    "warning": "#FF9800",
    "error": "#F44336",
    "info": "#2196F3"
  },
  "gradients": {
    "primary_gradient": ["#6750A4", "#8E24AA"],
    "secondary_gradient": ["#625B71", "#757575"],
    "sunset_gradient": ["#FF6B6B", "#FFE66D", "#4ECDC4"]
  }
}
''');
  }

  /// ç”Ÿæˆç¤ºä¾‹å›¾ç‰‡èµ„æº
  Future<void> _generateImageAssets(
      String templatePath, ScaffoldConfig config,) async {
    // åˆ›å»ºREADMEæ–‡ä»¶è¯´æ˜å›¾ç‰‡èµ„æº
    final imagesReadmeFile =
        File(path.join(templatePath, 'assets', 'images', 'README.md'));
    await imagesReadmeFile.writeAsString('''
# å›¾ç‰‡èµ„æºç›®å½•

è¿™ä¸ªç›®å½•ç”¨äºå­˜æ”¾åº”ç”¨çš„å›¾ç‰‡èµ„æºã€‚

## ç›®å½•ç»“æ„

```
images/
â”œâ”€â”€ icons/          # åº”ç”¨å›¾æ ‡
â”œâ”€â”€ logos/          # å“ç‰Œæ ‡å¿—
â”œâ”€â”€ backgrounds/    # èƒŒæ™¯å›¾ç‰‡
â”œâ”€â”€ illustrations/  # æ’å›¾
â””â”€â”€ avatars/        # å¤´åƒå›¾ç‰‡
```

## æ”¯æŒçš„æ ¼å¼

- PNG (æ¨èç”¨äºå›¾æ ‡å’Œé€æ˜å›¾ç‰‡)
- JPG/JPEG (æ¨èç”¨äºç…§ç‰‡)
- WebP (æ¨èç”¨äºç½‘ç»œä¼˜åŒ–)
- SVG (æ¨èç”¨äºçŸ¢é‡å›¾æ ‡)

## å‘½åè§„èŒƒ

- ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
- æè¿°æ€§å‘½åï¼š`user_avatar_placeholder.png`
- åŒ…å«å°ºå¯¸ä¿¡æ¯ï¼š`app_icon_48x48.png`
- çŠ¶æ€æ ‡è¯†ï¼š`button_pressed.png`

## å¤šåˆ†è¾¨ç‡æ”¯æŒ

ä¸ºä¸åŒå±å¹•å¯†åº¦æä¾›å¤šä¸ªç‰ˆæœ¬ï¼š

```
images/
â”œâ”€â”€ app_icon.png        # 1x (mdpi)
â”œâ”€â”€ 1.5x/
â”‚   â””â”€â”€ app_icon.png    # 1.5x (hdpi)
â”œâ”€â”€ 2.0x/
â”‚   â””â”€â”€ app_icon.png    # 2x (xhdpi)
â”œâ”€â”€ 3.0x/
â”‚   â””â”€â”€ app_icon.png    # 3x (xxhdpi)
â””â”€â”€ 4.0x/
    â””â”€â”€ app_icon.png    # 4x (xxxhdpi)
```

## ä½¿ç”¨æ–¹å¼

é€šè¿‡flutter_genç”Ÿæˆçš„ä»£ç è®¿é—®ï¼š

```dart
import 'package:${config.templateName}/generated/assets.gen.dart';

// ä½¿ç”¨å›¾ç‰‡
Image.asset(Assets.images.appIcon.path)

// ä½¿ç”¨SVG
SvgPicture.asset(Assets.images.logo.path)
```
''');

    // åˆ›å»ºå›¾æ ‡ç›®å½•çš„README
    final iconsReadmeFile =
        File(path.join(templatePath, 'assets', 'icons', 'README.md'));
    await iconsReadmeFile.writeAsString('''
# å›¾æ ‡èµ„æºç›®å½•

è¿™ä¸ªç›®å½•ç”¨äºå­˜æ”¾åº”ç”¨çš„å›¾æ ‡èµ„æºã€‚

## æ¨èçš„å›¾æ ‡åº“

- [Material Icons](https://fonts.google.com/icons)
- [Cupertino Icons](https://pub.dev/packages/cupertino_icons)
- [Font Awesome](https://pub.dev/packages/font_awesome_flutter)
- [Feather Icons](https://pub.dev/packages/feather_icons)

## è‡ªå®šä¹‰å›¾æ ‡

å¦‚æœéœ€è¦è‡ªå®šä¹‰å›¾æ ‡ï¼Œæ¨èä½¿ç”¨SVGæ ¼å¼ï¼š

```dart
import 'package:flutter_svg/flutter_svg.dart';
import 'package:${config.templateName}/generated/assets.gen.dart';

SvgPicture.asset(
  Assets.icons.customIcon.path,
  width: 24,
  height: 24,
  color: Theme.of(context).iconTheme.color,
)
```
''');
  }

  /// ç”Ÿæˆå­—ä½“èµ„æº
  Future<void> _generateFontAssets(
      String templatePath, ScaffoldConfig config,) async {
    // åˆ›å»ºå­—ä½“ç›®å½•çš„README
    final fontsReadmeFile =
        File(path.join(templatePath, 'assets', 'fonts', 'README.md'));
    await fontsReadmeFile.writeAsString('''
# å­—ä½“èµ„æºç›®å½•

è¿™ä¸ªç›®å½•ç”¨äºå­˜æ”¾åº”ç”¨çš„è‡ªå®šä¹‰å­—ä½“æ–‡ä»¶ã€‚

## æ”¯æŒçš„å­—ä½“æ ¼å¼

- TTF (TrueType Font)
- OTF (OpenType Font)
- WOFF/WOFF2 (Webå­—ä½“ï¼Œä¸»è¦ç”¨äºWebå¹³å°)

## å­—ä½“æ–‡ä»¶ç»„ç»‡

```
fonts/
â”œâ”€â”€ Roboto/
â”‚   â”œâ”€â”€ Roboto-Regular.ttf
â”‚   â”œâ”€â”€ Roboto-Bold.ttf
â”‚   â”œâ”€â”€ Roboto-Italic.ttf
â”‚   â””â”€â”€ Roboto-BoldItalic.ttf
â””â”€â”€ CustomFont/
    â”œâ”€â”€ CustomFont-Light.ttf
    â”œâ”€â”€ CustomFont-Regular.ttf
    â”œâ”€â”€ CustomFont-Medium.ttf
    â””â”€â”€ CustomFont-Bold.ttf
```

## pubspec.yamlé…ç½®

å­—ä½“éœ€è¦åœ¨pubspec.yamlä¸­å£°æ˜ï¼š

```yaml
flutter:
  fonts:
    - family: Roboto
      fonts:
        - asset: assets/fonts/Roboto/Roboto-Regular.ttf
        - asset: assets/fonts/Roboto/Roboto-Bold.ttf
          weight: 700
        - asset: assets/fonts/Roboto/Roboto-Italic.ttf
          style: italic
```

## ä½¿ç”¨æ–¹å¼

é€šè¿‡flutter_genç”Ÿæˆçš„ä»£ç è®¿é—®ï¼š

```dart
import 'package:${config.templateName}/generated/fonts.gen.dart';

Text(
  'Hello World',
  style: TextStyle(
    fontFamily: FontFamily.roboto,
    fontWeight: FontWeight.bold,
  ),
)
```

## æ¨èå­—ä½“

### ç³»ç»Ÿå­—ä½“
- **iOS**: San Francisco
- **Android**: Roboto
- **Web**: System fonts

### Google Fonts
å¯ä»¥ä½¿ç”¨google_fontsåŒ…ï¼š

```dart
import 'package:google_fonts/google_fonts.dart';

Text(
  'Hello World',
  style: GoogleFonts.roboto(),
)
```

### å¼€æºå­—ä½“æ¨è
- **Roboto**: Material Designé»˜è®¤å­—ä½“
- **Open Sans**: æ¸…æ™°æ˜“è¯»çš„æ— è¡¬çº¿å­—ä½“
- **Lato**: ç°ä»£æ„Ÿå¼ºçš„æ— è¡¬çº¿å­—ä½“
- **Source Sans Pro**: Adobeå¼€æºå­—ä½“
- **Noto Sans**: Googleå¤šè¯­è¨€å­—ä½“
''');
  }
}
